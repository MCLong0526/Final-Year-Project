import{V as U,r as I}from"./VForm-ByT5jH_s.js";import{l as j}from"./logo-1jkZqtsd.js";import{_ as q,J as D,d as G,b as J,r as u,f as C,l as o,c as s,w as t,q as e,I as F,F as H,o as c,V as _,A as r,x as f,e as y,t as T,z as S,B as E,y as K,j as O,k as Q}from"./main-lEbZc9Qq.js";import{d as W,e as X,b as B,V as Y,a as $}from"./VCard-C3wGqAAU.js";import{V as Z}from"./VSnackbar-0nDvo1MC.js";import{V as A}from"./VTextField-DOMG4b8r.js";import{V as ee}from"./VAlert-m1M1zRvo.js";import"./forwardRefs-BsNUNB3i.js";import"./VImg-w9c1v4tP.js";import"./VOverlay-DnFcKNdn.js";const k=g=>(O("data-v-7560b8c8"),g=g(),Q(),g),ae={class:"auth-wrapper"},se={class:"auth-content"},te={class:"d-flex"},le=["src"],oe={class:"text-h5 font-weight-semibold mb-1"},re={key:0,class:"mb-0"},ie=k(()=>o("br",null,null,-1)),ne=k(()=>o("span",null,[o("b",null,"A verification code will be sent to your email.")],-1)),ue={key:1,class:"mb-0"},ce=k(()=>o("br",null,null,-1)),de=k(()=>o("span",null,[o("b",null,"Click the button below to send a temporary password to your email.")],-1)),me={__name:"forgot-password",setup(g){const L=D();G(()=>L.global.name.value==="light"?authV1MaskLight:authV1MaskDark),J();const i=u(""),h=u(""),v=u(""),w=u(""),p=u(!1),V=u(!1),n=u(!1),d=u(!1),b=u(!1),x=a=>/^[0-9]{5}@siswa\.unimas\.my$/.test(a)||"Email format is invalid (12345@siswa.unimas.my)",M=async()=>{if(n.value=!0,!x(i.value)){v.value="Email format is invalid (12345@siswa.unimas.my)",p.value=!0,n.value=!1;return}try{const a=await E.post("/api/auth/verify-code",{email:i.value});w.value=a.data.message,n.value=!1,V.value=!0,b.value=!0}catch(a){n.value=!1,p.value=!0,v.value=a.response.data.message,console.error("Error:",a)}},R=async()=>{p.value=!1;try{const a=await E.post("/api/auth/check-verification-code",{email:i.value,verification_code:h.value});w.value=a.data.message,h.value=null,V.value=!0,d.value=!0}catch(a){v.value=a.response.data.message,p.value=!0}},N=async()=>{if(n.value=!0,!x(i.value)){v.value="Email format is invalid (12345@siswa.unimas.my)",p.value=!0,n.value=!1;return}try{await E.post("/api/auth/forgot-password",{email:i.value}),n.value=!1,i.value=null,V.value=!0}catch(a){n.value=!1,p.value=!0,v.value=a.response.data.message,console.error("Error:",a)}},P=a=>/^[0-9]{6}$/.test(a)||"Verification code format is invalid (123456)";return(a,l)=>{const z=K("RouterLink");return c(),C(H,null,[o("div",ae,[o("div",se,[s(W,{loading:e(n),class:"auth-card pa-4 pt-7","max-width":"448"},{default:t(()=>[s(X,{class:"justify-center"},{prepend:t(()=>[o("div",te,[o("img",{src:e(j),alt:"Materio",class:"mr-2",height:"180",width:"200"},null,8,le)])]),_:1}),s(B,{class:"pt-2"},{default:t(()=>[o("h5",oe,[s(_,{size:"20",class:"mr-2",icon:"ri-lock-password-line"}),r("Forgot Password? ")]),e(d)===!1?(c(),C("p",re,[r(" Verify your email address first. "),ie,ne])):f("",!0),e(d)===!0?(c(),C("p",ue,[r(" Verification code is correct. "),ce,de])):f("",!0)]),_:1}),s(B,null,{default:t(()=>[s(e(U),{ref:"refForm"},{default:t(()=>[s(Y,null,{default:t(()=>[s($,{cols:"12"},{default:t(()=>[e(b)===!1&&e(d)===!1?(c(),y(A,{key:0,modelValue:e(i),"onUpdate:modelValue":l[0]||(l[0]=m=>F(i)?i.value=m:null),label:"Email",type:"email",rules:[e(I),x]},null,8,["modelValue","rules"])):f("",!0),e(b)===!0&&e(d)===!1?(c(),y(A,{key:1,modelValue:e(h),"onUpdate:modelValue":l[1]||(l[1]=m=>F(h)?h.value=m:null),label:"Verification Code",type:"integer",rules:[e(I),P]},null,8,["modelValue","rules"])):f("",!0)]),_:1}),s($,{cols:"12"},{default:t(()=>[e(p)?(c(),y(ee,{key:0,type:"error",variant:"tonal",closable:"",class:"mb-2"},{default:t(()=>[r(T(e(v)),1)]),_:1})):f("",!0),e(b)===!1&&e(d)===!1?(c(),y(S,{key:1,block:"",type:"button",onClick:l[2]||(l[2]=m=>a.$refs.refForm.validate().then(()=>M()))},{default:t(()=>[r(" Send Verification Code "),s(_,{class:"ms-2",icon:"ri-mail-send-fill"})]),_:1})):f("",!0),e(b)===!0&&e(d)===!1?(c(),y(S,{key:2,block:"",type:"button",onClick:l[3]||(l[3]=m=>a.$refs.refForm.validate().then(()=>R()))},{default:t(()=>[r(" Verify Code "),s(_,{class:"ms-2",icon:"ri-mail-check-fill"})]),_:1})):f("",!0),e(d)===!0?(c(),y(S,{key:3,block:"",type:"button",onClick:l[4]||(l[4]=m=>a.$refs.refForm.validate().then(()=>N()))},{default:t(()=>[r(" Send Temporary Password "),s(_,{class:"ms-2",icon:"ri-key-2-fill"})]),_:1})):f("",!0)]),_:1}),s($,{cols:"12",class:"text-center text-base"},{default:t(()=>[s(z,{class:"text-primary ms-2",to:"/login"},{default:t(()=>[s(_,{class:"mb-1",icon:"ri-arrow-left-double-line"}),r(" Go to Login ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])])]),s(Z,{modelValue:e(V),"onUpdate:modelValue":l[5]||(l[5]=m=>F(V)?V.value=m:null),location:"top end",transition:"scale-transition",color:"success"},{default:t(()=>[s(_,{size:"20",class:"me-2"},{default:t(()=>[r("ri-checkbox-circle-line")]),_:1}),r(" "+T(e(w)),1)]),_:1},8,["modelValue"])],64)}}},we=q(me,[["__scopeId","data-v-7560b8c8"]]);export{we as default};
