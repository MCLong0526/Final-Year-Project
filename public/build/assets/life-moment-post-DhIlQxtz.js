import{_ as Ie,r as i,B as R,G as L,f as b,c as e,w as t,q as s,I as w,F as j,o as p,l as r,U as D,e as W,x as T,h as oe,V as g,A as z,z as U,n as xe,t as Ce,j as Se,k as Ee}from"./main-7WY3HAzV.js";import{V as me,r as ve}from"./VForm-RhdCbbiq.js";import{_ as Fe}from"./chat-BKH9mOFW.js";import{S as se}from"./ShowPosts-B8VVb-nY.js";import{u as Le}from"./AuthStore-DIjGcMSf.js";import{l as O}from"./lodash-BYTxXjAY.js";import{V as y,a as u,b as ne,c as ge,d as re,f as De,h as Te}from"./VCard-CMdUx4jw.js";import{a as _e,V as ze}from"./VDialog-C5llJCWP.js";import{V as $e}from"./VSnackbar-iwg430vD.js";import{V as he}from"./VImg-DnGycZwo.js";import{V as Y}from"./VTextField-DVBKdH55.js";import{V as Ae,a as Be}from"./VChip-CHQxlIdL.js";import{V as K}from"./VTooltip-BB6OD2CA.js";import{V as Ne,a as we,b as Ge,c as ye}from"./VWindowItem-DFDvBVLB.js";import"./forwardRefs-DrIdGHCT.js";import"./picker-DE4OueUM.js";import"./VContainer-CVxtPOA5.js";import"./VAlert-d82UI2Ce.js";import"./VMenu-B5zFScDQ.js";import"./VOverlay-D1RCBp6Z.js";import"./_commonjsHelpers-BosuxZz1.js";import"./ssrBoot-BbcYeQ41.js";const d=$=>(Se("data-v-e907be14"),$=$(),Ee(),$),Re={class:"box-style"},We={class:"d-flex align-items-center"},qe={class:"upload-container"},He=d(()=>r("p",{class:"upload-text"},"Drag & Drop your picture here.",-1)),Je=d(()=>r("p",{class:"upload-text"},"Click here to upload picture (PNG, JPEG, JPG).",-1)),Me={key:0,class:"uploaded-images"},je=d(()=>r("p",{class:"upload-text"},"Selected picture: ",-1)),Oe=["src"],Ye=d(()=>r("span",{class:"ml-2"},"Upload Image",-1)),Ke=d(()=>r("span",null,"Click here to upload image!",-1)),Qe=d(()=>r("span",{class:"ml-2"},"Create Post ",-1)),Xe=d(()=>r("span",null,"Click here to add new post!",-1)),Ze={class:"box-style"},el=d(()=>r("span",null,"All Posts",-1)),ll=d(()=>r("span",null,"Followed Users Posts",-1)),tl=d(()=>r("span",{class:"ml-2"},"Load More",-1)),al=d(()=>r("label",{for:"firstNameHorizontalIcons"},"Post Content",-1)),ol=d(()=>r("label",{for:"emailHorizontalIcons"},"Post Image",-1)),sl={class:"upload-container"},nl=d(()=>r("p",{class:"upload-text"},"Drag & Drop your picture here.",-1)),rl=d(()=>r("p",{class:"upload-text"},"Click here to upload picture (PNG, JPEG, JPG).",-1)),il={key:0,class:"uploaded-images"},ul=d(()=>r("p",{class:"upload-text"},"Selected picture: ",-1)),dl=["src"],cl=d(()=>r("span",null,"Click here to upload image",-1)),fl=d(()=>r("span",null,"Click here to view all posts!",-1)),pl=d(()=>r("span",{class:"ml-2"},"All Posts",-1)),ml=d(()=>r("span",null,"Post created successfully!",-1)),vl={__name:"life-moment-post",props:{relatedId:{type:String,default:""}},emits:["update:relatedId"],setup($,{emit:gl}){const A=$,Q=Le(),X=i([]),q=i(!1),C=i(!1),Z=i(5);let S=1;const B=i(!1),f=i(""),V=i([]),m=i([]),I=i([]),k=i(""),P=i(""),ee=i("all"),H=i(!1),v=i([]),N=i([]),E=i(!1),x=i({}),G=i(!1),_=i("tab-1"),Ve=async()=>{try{const n=localStorage.getItem("token");if(!n)throw new Error("Token not found");const a=await R.get("/api/auth/get-user-by-token",{headers:{Authorization:`Bearer ${n}`}});X.value=a.data.user}catch(n){console.error(n)}},ie=n=>{n.preventDefault();const a=n.dataTransfer.files;ue(a)},ue=n=>{const a=n[0];if(a.type.startsWith("image/")){const o=new FileReader;o.onload=l=>{V.value=[{url:l.target.result,file:a}]},o.readAsDataURL(a)}},J=i(null),de=()=>{J.value&&J.value.click()},ce=n=>{const a=n.target.files;ue(a)},fe=n=>{V.value.splice(n,1)},pe=()=>{R.post("/api/posts/store",{content:f.value,picture:V.value}).then(n=>{q.value=!1,f.value=null,V.value=[],m.value=[],H.value=!0,h()}).catch(n=>{console.log(n)})},h=O.debounce(()=>{let n="/api/posts?page="+S+"&per_page="+Z.value;k.value&&k.value.length>2&&k.value!==null&&(n+="&search="+k.value),A.relatedId&&(m.value=[],n+="&related_id="+A.relatedId),R.get(n).then(({data:a})=>{const o=a.data.unrelated_posts.data;o.forEach(l=>{l.user.avatar&&(l.user.avatar="/storage/"+l.user.avatar)}),o.forEach(l=>{l.picture&&(l.picture="/storage/"+l.picture)}),o.forEach(l=>{l.created_at=new Date(l.created_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}),o.forEach(l=>{l.likes_count=l.likes.length}),o.forEach(l=>{l.is_liked=l.likes.some(c=>c.user_id===Q.user.user_id)}),m.value.forEach(l=>{v.value.some(c=>c.user_id===l.user.user_id)?l.is_following=!0:l.is_following=!1}),m.value=[...m.value,...o],m.value=m.value.reverse().filter((l,c,te)=>c===te.findIndex(ae=>ae.post_id===l.post_id)).reverse(),console.log(m.value),A.relatedId&&(x.value=a.data.related_posts.data,x.value.forEach(l=>{l.picture&&(l.picture="/storage/"+l.picture)}),x.value.forEach(l=>{l.user.avatar&&(l.user.avatar="/storage/"+l.user.avatar)}),x.value.forEach(l=>{l.created_at=new Date(l.created_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}),x.value.forEach(l=>{l.likes_count=l.likes.length}),x.value.forEach(l=>{l.is_liked=l.likes.some(c=>c.user_id===Q.user.user_id)}),G.value=!0)}).catch(a=>{console.log(a)})},500),F=O.debounce(()=>{let n="/api/posts/follows?page="+S+"&per_page="+Z.value;P.value&&P.value.length>2&&P.value!==null&&(n+="&search="+P.value),R.get(n).then(({data:a})=>{const o=a.data.follows_posts.data;o.forEach(l=>{l.user.avatar&&(l.user.avatar="/storage/"+l.user.avatar)}),o.forEach(l=>{l.picture&&(l.picture="/storage/"+l.picture)}),o.forEach(l=>{l.created_at=new Date(l.created_at).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"})}),o.forEach(l=>{l.likes_count=l.likes.length}),o.forEach(l=>{l.is_liked=l.likes.some(c=>c.user_id===Q.user.user_id)}),I.value.forEach(l=>{v.value.some(c=>c.user_id===l.user.user_id)?l.is_following=!0:l.is_following=!1}),I.value=[...I.value,...o],I.value=I.value.reverse().filter((l,c,te)=>c===te.findIndex(ae=>ae.post_id===l.post_id)).reverse()}).catch(a=>{console.log(a)})},500),ke=()=>window.innerHeight+window.scrollY<=document.body.offsetHeight;let le=!1;const Pe=()=>{!le&&ke()&&m.value.length%Z.value===0&&(le=!0,S+=1,B.value=!0,setTimeout(()=>{_.value==="tab-1"?h():F(),le=!1,B.value=!1},1500))},be=()=>{S+=1,_.value==="tab-1"?h():F()},M=()=>{R.get("/api/users/get-following").then(n=>{v.value=n.data.data}).catch(n=>{console.log(n)})};window.addEventListener("scroll",Pe),L(k,O.debounce(()=>{S=1,m.value=[],h()},500)),L(P,O.debounce(()=>{S=1,I.value=[],F()},500)),L(f,()=>{setTimeout(()=>{if(f.value.charAt(f.value.length-1)==="@")E.value=!0,N.value=v.value;else if(f.value.includes("@")&&E.value===!1&&N.value.length>0){E.value=!0;const n=f.value.split("@").slice(-1)[0].split(" ")[0].toLowerCase();N.value=v.value.filter(a=>a.username.toLowerCase().includes(n))}else E.value=!1},500)});const Ue=n=>{const a=f.value.split("@").slice(0,-1).join("@");f.value=`${a}@${n.username} `,N.value=[],E.value=!1};return L(()=>A.relatedId,n=>{n&&h()}),L(()=>A.relatedId,n=>{n===""&&window.location.reload()}),L(()=>_,n=>{n==="tab-1"?h():F()}),h(),F(),Ve(),M(),(n,a)=>(p(),b(j,null,[e(y,null,{default:t(()=>[e(u,{cols:"12",md:"8"},{default:t(()=>[r("div",Re,[e(ne,null,{default:t(()=>[e(s(me),{ref:"refForm",onSubmit:a[4]||(a[4]=D(()=>{},["prevent"]))},{default:t(()=>[e(y,null,{default:t(()=>[e(u,{cols:"12"},{default:t(()=>[e(y,{"no-gutters":""},{default:t(()=>[e(u,{cols:"12",md:"1"},{default:t(()=>[r("div",We,[s(X).avatar?(p(),W(ge,{key:0,size:"50"},{default:t(()=>[e(he,{src:s(X).avatar},null,8,["src"])]),_:1})):T("",!0)])]),_:1}),e(u,{cols:"12",md:"11"},{default:t(()=>[e(Y,{modelValue:s(f),"onUpdate:modelValue":a[0]||(a[0]=o=>w(f)?f.value=o:null),"prepend-inner-icon":"ri-message-2-line",rounded:"",placeholder:"What's on your mind?",rules:[s(ve)]},null,8,["modelValue","rules"]),s(E)&&s(v).length>0?(p(),W(Ae,{key:0,style:{"max-block-size":"80px","overflow-y":"auto"}},{default:t(()=>[(p(!0),b(j,null,oe(s(N),(o,l)=>(p(),W(Be,{key:l,onClick:c=>Ue(o)},{default:t(()=>[e(ge,{size:"32",color:o.avatar?"":"primary",class:xe(`${o.avatar?"":"v-avatar-light-bg primary--text"}`),variant:o.avatar?void 0:"tonal",style:{"margin-inline-end":"8px"}},{default:t(()=>[e(he,{src:o.avatar},null,8,["src"])]),_:2},1032,["color","class","variant"]),z(" "+Ce(o.username),1)]),_:2},1032,["onClick"]))),128))]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1}),s(C)===!0?(p(),W(u,{key:0,cols:"12"},{default:t(()=>[e(y,{"no-gutters":""},{default:t(()=>[e(u,{cols:"12",md:"3"}),e(u,{cols:"12",md:"8"},{default:t(()=>[r("div",qe,[r("input",{type:"file",ref_key:"fileInput",ref:J,style:{display:"none"},accept:"image/*",onChange:ce},null,544),r("div",{class:"upload-box",onDrop:D(ie,["prevent"]),onDragover:a[1]||(a[1]=D(()=>{},["prevent"])),onClick:de},[e(g,{class:"upload-icon"},{default:t(()=>[z("ri-image-add-line")]),_:1}),He,Je,s(V).length>0?(p(),b("div",Me,[je,(p(!0),b(j,null,oe(s(V),(o,l)=>(p(),b("div",{key:l,class:"uploaded-image"},[r("img",{src:o.url,alt:"Uploaded Image"},null,8,Oe),e(U,{onClick:c=>fe(l),icon:"ri-close-line",class:"remove-btn"},null,8,["onClick"])]))),128))])):T("",!0)],32)])]),_:1})]),_:1})]),_:1})):T("",!0),e(u,{"offset-md":"3",cols:"12",md:"9",class:"d-flex gap-4"},{default:t(()=>[e(U,{color:"secondary",variant:"tonal",onClick:a[2]||(a[2]=o=>C.value=!s(C))},{default:t(()=>[e(g,{icon:"ri-chat-upload-line",size:"20"}),Ye,e(K,{"open-delay":"500",location:"top",activator:"parent",transition:"scroll-y-transition"},{default:t(()=>[Ke]),_:1})]),_:1}),e(U,{type:"submit",onClick:a[3]||(a[3]=o=>n.$refs.refForm.validate().then(()=>pe()))},{default:t(()=>[e(g,{icon:"ri-send-plane-2-line",size:"20"}),Qe,e(K,{"open-delay":"500",location:"top",activator:"parent",transition:"scroll-y-transition"},{default:t(()=>[Xe]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),r("div",Ze,[e(Ne,{modelValue:s(_),"onUpdate:modelValue":a[5]||(a[5]=o=>w(_)?_.value=o:null),grow:"",stacked:""},{default:t(()=>[e(we,{value:"tab-1"},{default:t(()=>[e(g,{icon:"ri-message-2-line",class:"mb-2"}),el]),_:1}),e(we,{value:"tab-2"},{default:t(()=>[e(g,{icon:"ri-chat-heart-line",class:"mb-2"}),ll]),_:1})]),_:1},8,["modelValue"]),e(Ge,{modelValue:s(_),"onUpdate:modelValue":a[9]||(a[9]=o=>w(_)?_.value=o:null),class:"mt-5"},{default:t(()=>[e(ye,{value:"tab-1"},{default:t(()=>[e(y,{class:"mt-1 ml-2 mr-2"},{default:t(()=>[e(u,{cols:"12",md:"7"},{default:t(()=>[e(U,{onClick:a[6]||(a[6]=o=>be()),color:"primary",class:"mb-2"},{default:t(()=>[e(g,{icon:"ri-arrow-down-s-line",size:"20"}),tl]),_:1})]),_:1}),e(u,{cols:"12",md:"5"},{default:t(()=>[e(Y,{modelValue:s(k),"onUpdate:modelValue":a[7]||(a[7]=o=>w(k)?k.value=o:null),label:"Search",clearable:"","prepend-inner-icon":"ri-search-line",placeholder:"Placeholder Text"},null,8,["modelValue"])]),_:1})]),_:1}),e(se,{posts:s(m),getPosts:s(h),getFollowingUsers:M,showLoading:s(B),typePosts:s(ee),followingUsers:s(v)},null,8,["posts","getPosts","showLoading","typePosts","followingUsers"])]),_:1}),e(ye,{value:"tab-2"},{default:t(()=>[e(y,{class:"mt-1 ml-2 mr-2"},{default:t(()=>[e(u,{cols:"12",md:"7"}),e(u,{cols:"12",md:"5"},{default:t(()=>[e(Y,{modelValue:s(P),"onUpdate:modelValue":a[8]||(a[8]=o=>w(P)?P.value=o:null),label:"Search",clearable:"","prepend-inner-icon":"ri-search-line",placeholder:"Placeholder Text"},null,8,["modelValue"])]),_:1})]),_:1}),e(se,{posts:s(I),getPosts:s(F),getFollowingUsers:M,showLoading:s(B),typePosts:s(ee),followingUsers:s(v)},null,8,["posts","getPosts","showLoading","typePosts","followingUsers"])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),e(u,{cols:"12",md:"4"},{default:t(()=>[e(re,{title:"Followed Users"},{default:t(()=>[e(Fe,{followingUsers:s(v)},null,8,["followingUsers"])]),_:1})]),_:1})]),_:1}),e(_e,{modelValue:s(q),"onUpdate:modelValue":a[15]||(a[15]=o=>w(q)?q.value=o:null),"max-width":"600"},{default:t(()=>[e(re,{title:"New Post Information"},{default:t(()=>[e(ne,null,{default:t(()=>[e(s(me),{ref:"refForm",onSubmit:a[14]||(a[14]=D(()=>{},["prevent"]))},{default:t(()=>[e(y,null,{default:t(()=>[e(u,{cols:"12"},{default:t(()=>[e(y,{"no-gutters":""},{default:t(()=>[e(u,{cols:"12",md:"3"},{default:t(()=>[al]),_:1}),e(u,{cols:"12",md:"9"},{default:t(()=>[e(Y,{modelValue:s(f),"onUpdate:modelValue":a[10]||(a[10]=o=>w(f)?f.value=o:null),"prepend-inner-icon":"ri-message-2-line",placeholder:"What's on your mind?",rules:[s(ve)]},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),s(C)===!0?(p(),W(u,{key:0,cols:"12"},{default:t(()=>[e(y,{"no-gutters":""},{default:t(()=>[e(u,{cols:"12",md:"3"},{default:t(()=>[ol]),_:1}),e(u,{cols:"12",md:"9"},{default:t(()=>[r("div",sl,[r("input",{type:"file",ref_key:"fileInput",ref:J,style:{display:"none"},accept:"image/*",onChange:ce},null,544),r("div",{class:"upload-box",onDrop:D(ie,["prevent"]),onDragover:a[11]||(a[11]=D(()=>{},["prevent"])),onClick:de},[e(g,{class:"upload-icon"},{default:t(()=>[z("ri-image-add-line")]),_:1}),nl,rl,s(V).length>0?(p(),b("div",il,[ul,(p(!0),b(j,null,oe(s(V),(o,l)=>(p(),b("div",{key:l,class:"uploaded-image"},[r("img",{src:o.url,alt:"Uploaded Image"},null,8,dl),e(U,{onClick:c=>fe(l),icon:"ri-close-line",class:"remove-btn"},null,8,["onClick"])]))),128))])):T("",!0)],32)])]),_:1})]),_:1})]),_:1})):T("",!0),e(u,{"offset-md":"3",cols:"12",md:"9",class:"d-flex gap-4"},{default:t(()=>[e(U,{color:"secondary",variant:"tonal",onClick:a[12]||(a[12]=o=>C.value=!s(C))},{default:t(()=>[e(g,{icon:"ri-chat-upload-line",size:"20"}),e(K,{"open-delay":"500",location:"top",activator:"parent",transition:"scroll-y-transition"},{default:t(()=>[cl]),_:1})]),_:1}),e(U,{type:"submit",onClick:a[13]||(a[13]=o=>n.$refs.refForm.validate().then(()=>pe()))},{default:t(()=>[z(" Post ")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(_e,{modelValue:s(G),"onUpdate:modelValue":a[17]||(a[17]=o=>w(G)?G.value=o:null),"max-width":"600",persistent:""},{default:t(()=>[e(re,null,{default:t(()=>[e(De,{class:"text-overline text-center mt-2",style:{"font-size":"20px !important"}},{default:t(()=>[z(" Related Post ")]),_:1}),e(ne,{style:{"block-size":"260px","overflow-y":"auto"}},{default:t(()=>[e(se,{posts:s(x),getPosts:s(h),getFollowingUsers:M,showLoading:s(B),typePosts:s(ee),followingUsers:s(v)},null,8,["posts","getPosts","showLoading","typePosts","followingUsers"])]),_:1}),e(Te,null,{default:t(()=>[e(ze),e(U,{to:{name:"life-moment-post",params:{relatedId:""}},color:"primary",onClick:a[16]||(a[16]=o=>G.value=!1),class:"ma-2"},{default:t(()=>[e(K,{"open-delay":"500",location:"top",activator:"parent",transition:"scroll-y-transition"},{default:t(()=>[fl]),_:1}),e(g,{icon:"ri-chat-3-line",size:"20"}),pl]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e($e,{modelValue:s(H),"onUpdate:modelValue":a[18]||(a[18]=o=>w(H)?H.value=o:null),location:"top end",transition:"scale-transition",color:"success"},{default:t(()=>[e(g,{size:"20",class:"me-2"},{default:t(()=>[z("ri-checkbox-circle-line")]),_:1}),ml]),_:1},8,["modelValue"])],64))}},Nl=Ie(vl,[["__scopeId","data-v-e907be14"]]);export{Nl as default};
